<div class="sidebar">

    <button mat-stroked-button class="previousBtn" (click)="location.back()">
        <mat-icon>arrow_back</mat-icon>Previous
    </button>

</div>

<div *ngIf="!rerender" class="main-content">

    <!-- show the number of results found in Knora -->
    <div *ngIf="numberOfAllResults !== 0 && result; else noResult">
        <h4>Number of results: {{numberOfAllResults + numberOfExternalResults}}</h4>

        <dsp-progress-indicator *ngIf="isLoading" [color]="'#D88958'"></dsp-progress-indicator>

        <!-- the following list will be moved to @knora/viewer views -->
        <mat-accordion class="example-headers-align">
            <mat-expansion-panel *ngFor="let res of result; let i = index; let first = first; let last = last;"
                [expanded]="step === i" (opened)="setStep(i)" hideToggle>
                <mat-expansion-panel-header>
                    <mat-panel-title>
                        {{res?.entityInfo.classes[res.type].label}}
                    </mat-panel-title>

                    <mat-panel-description>
                        {{res?.label}}
                    </mat-panel-description>
                </mat-expansion-panel-header>

                <!-- content of the resource -->
                <!-- this should be implemented from @knora/viewer object -->
                <div mat-line *ngFor="let prop of res.properties | keyvalue">
                    <ul>
                        <li *ngFor="let val of prop.value | keyvalue" class="without-bullets">
                            <div [ngSwitch]="val.value.type">

                                <!-- only render math if panel is open: step === i-->
                                <span *ngSwitchCase="dspConstants.TextValue" [mathJax]="val.value?.strval"
                                      [renderMath]="step === i" [valueObject]="val.value" [resource]="res"
                                      [bindEvents]="false"></span>

                                <span class="bolder">
                                    <dsp-date-value *ngSwitchCase="dspConstants.DateValue" [displayValue]="val.value" [mode]="'read'">
                                    </dsp-date-value>

                                    <read-list-value *ngSwitchCase="dspConstants.ListValue" [valueObject]="val.value"
                                                     [renderMath]="step === i"></read-list-value>

                                    <span *ngSwitchDefault>{{val.value.strval}}</span>
                                </span>

                                <br>
                                <span class="mat-caption"
                                    *ngIf="res?.entityInfo.properties[prop.key].label !== 'Text'">
                                    {{res?.entityInfo.properties[prop.key].label}}
                                </span>

                            </div>
                        </li>
                    </ul>
                </div>

                <!-- go to the viewer to access the resource information -->
                <button mat-button color="primary" (click)="goToViewer(res.id, res.type)">Read more &rarr;</button>

                <mat-action-row>
                    <button mat-button color="accent" *ngIf="!first" (click)="prevStep()">Previous</button>
                    <button mat-button color="primary" *ngIf="!last" (click)="nextStep()">Next</button>
                </mat-action-row>
            </mat-expansion-panel>

        </mat-accordion>
        <div class="action-panel" *ngIf="result.length > 0">
            <button mat-button class="link center" (click)="loadMore()" *ngIf="offset < maxOffset">Load more<br>
                <mat-icon>keyboard_arrow_down</mat-icon>
            </button>
        </div>
    </div>


    <!-- In case of 0 result -->
    <ng-template #noResult>
        <br>
        <br>
        <p><strong>No result</strong></p>
    </ng-template>

    <!-- Error message -->
    <div *ngIf="errorMessage">
        OUPS ERROR: {{errorMessage}}
    </div>

</div>
